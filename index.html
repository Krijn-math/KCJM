<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KCJM</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

  <style>

    .montserrat {
    font-family: "Montserrat", sans-serif;
    font-optical-sizing: auto;
    font-weight: 450;
    font-style: normal;
    }

    body {
      font-family: "Montserrat", sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 4px;
      background: #000;
      overflow: hidden;
    }

    .block {
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .block img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.5s ease;
      opacity: 0.6;
    }

    .nameblock {
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .nameblock img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.3s;
      opacity: 0.6;
    }

    .label {
      position: absolute;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 2rem;
      opacity: 0;
      transition: opacity 0.3s;
      background: rgba(0,0,0,0.3);
      opacity: 1;
    }

    .block:hover img { opacity: 1; }
    .block:hover .label { opacity: 0; }

    /* --- INSIDE VIEW --- */
    #insideView {
      display: none;
      position: fixed;
      inset: 0;
      background: #000;
      z-index: 9999;
      padding: 0px;
      box-sizing: border-box;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 4px;
    }

    #insideView .cell {
      position: relative;
      overflow: hidden;
      border-radius: 10px;
      background: #111;
      cursor: pointer;
    }

    #insideView .cell img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      opacity: 0;
      transition: opacity 1s ease;
    }


    #insideView .cell img.loaded {
      opacity: 1;
    }


    /* --- FULL VIEW OVERLAY --- */
    #fullViewOverlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      z-index: 20000;
      /* display: flex; */
      justify-content: center;
      align-items: center;
    }

    #fullViewOverlay img {
      max-width: 90vw;
      max-height: 90vh;
      border-radius: 10px;
    }

    #fullViewOverlay #closeFull {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      opacity: 30%;
      padding: 6px 12px;
      border-radius: 2px;
      font-size: 20px;
      cursor: pointer;
      z-index: 20001;
    }

    #closeBtn {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      opacity: 50%;
      padding: 6px 12px;
      border-radius: 2px;
      font-size: 20px;
      cursor: pointer;
      z-index: 10000;
    }

      #mainGridFader {
    position: fixed;
    inset: 0;
    background: black;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
    z-index: 5000;
  }

  </style>
</head>
<body>

  <div class="block" id="B1"><img /><div class="label">Colombia</div></div>
  <div class="block" id="B2"><img /><div class="label">Galapagos</div></div>
  <div class="block" id="B3"><img /><div class="label">Amazon</div></div>
  <div class="block" id="B4"><img /><div class="label">Birds</div></div>
  <div class="nameblock" id="B5"><img /><div class="label">K. C. J. M. </div></div>
  <div class="block" id="B6"><img /><div class="label">India</div></div>
  <div class="block" id="B7"><img /><div class="label">Cats</div></div>
  <div class="block" id="B8"><img /><div class="label">Nimma</div></div>
  <div class="block" id="B9"><img /><div class="label">Art</div></div>

  <div id="insideView"></div>

  <div id="fullViewOverlay">
    <div id="closeFull">X</div>
    <img id="fullImg" />
  </div>

  <script>
    const folders = {
      B1: 'COLOMBIA', B2: 'GALAPAGOS', B3: 'AMAZON',
      B4: 'BIRDS', B5: 'ME', B6: 'INDIA',
      B7: 'CATS', B8: 'NIMMA', B9: 'ART'
    };

    const blocks = document.querySelectorAll('.block');
    const insideView = document.getElementById('insideView');
    const fullOverlay = document.getElementById('fullViewOverlay');
    const fullImg = document.getElementById('fullImg');
    const closeFull = document.getElementById('closeFull');

    function shuffle(a) { return a.sort(() => Math.random() - 0.5); }
    function setMainVisible(v) {
      document.querySelectorAll('.block').forEach(b => b.style.visibility = v ? 'visible' : 'hidden');
    }

    function loadRandomImage(blockId) {
      const folder = folders[blockId];
      fetch(`${folder}/index.json`)
        .then(r => r.json())
        .then(list => {
          const img = document.querySelector(`#${blockId} img`);
          img.src = `${folder}/thumbs/` + shuffle([...list])[0];
        });
    }

    Object.keys(folders).forEach(loadRandomImage);

    function closeInside() {
      insideView.style.display = 'none';
      insideView.innerHTML = '';

      // setTimeout(() =>   setMainVisible(true), 500)
      setMainVisible(true);
      document.body.style.overflow = '';

      // restore all main images full opacity
      document.querySelectorAll('.block img').forEach(img => {
        img.style.opacity = '';
      });

        document.querySelectorAll('.block .label').forEach(label => {
    label.style.opacity = '';   // allow CSS to control it again
  });
  
    }

    function openFullView(src) {
      fullImg.src = src;
      fullOverlay.style.display = 'flex';
    }

    closeFull.onclick = () => {
      fullOverlay.style.display = 'none';
    };

    function openInside(id) {

    const clickedThumb = document.querySelector(`#${id} img`).src;

    document.querySelectorAll('.block img').forEach(img => {
      img.style.opacity = (img.src === clickedThumb) ? '1' : '0';
    });

    document.querySelectorAll('.block .label').forEach(img => {
      img.style.opacity = (img.src === clickedThumb) ? '1' : '0';
    });

    setTimeout(() => loadInsideGrid(id, clickedThumb), 500);
    }


function loadInsideGrid(id, clickedThumb) {

insideView.innerHTML = '';

const close = document.createElement('div');
close.id = 'closeBtn';
close.textContent = 'X';
close.addEventListener('click', closeInside);
insideView.appendChild(close);

fetch(`${folders[id]}/index.json`)
  .then(r => r.json())
  .then(list => {

    const shuffled = shuffle([...list]);
    const picks = shuffled.slice(0, Math.min(8, shuffled.length));

    const order = ['B1','B2','B3','B4','B5','B6','B7','B8','B9'];

    const finalArr = Array(9);
    const clickedIndex = order.indexOf(id);

    const clickedFull = clickedThumb.replace('/thumbs/', '/');
    finalArr[clickedIndex] = clickedFull;

    let p = 0;
    for (let i = 0; i < 9; i++) {
      if (i !== clickedIndex) {
        finalArr[i] = `${folders[id]}/` + picks[p++ % picks.length];
      }
    }

    insideView.style.display = 'grid';

    finalArr.forEach(src => {
      const cell = document.createElement('div');
      cell.className = 'cell';

      const img = document.createElement('img');
      img.src = src.includes('/thumbs/')
        ? src
        : src.replace(`${folders[id]}/`, `${folders[id]}/thumbs/`);

      img.onload = () => img.classList.add('loaded');

      img.addEventListener('click', () => openFullView(src));

      cell.appendChild(img);
      insideView.appendChild(cell);
    });

    setMainVisible(false);
    document.body.style.overflow = 'hidden';
  });
}


    blocks.forEach(block => block.addEventListener('click', () => openInside(block.id)));

    // ESC close functionality
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (fullOverlay.style.display === 'flex') {
          closeFull.click();
        } else if (insideView.style.display === 'grid') {
          closeInside();
        }
      }
    });
</script>
</body>
</html>
